<launch>

  <param name="head_camera/driver/z_offset_mm" value="0.0"/>
  <param name="head_camera/driver/z_scaling" value="1.0"/>

  <arg name="velocity_factor" default="1.0" />
  <arg name="moveit" default="false" />
  <arg name="use_camera" default="true"/>

  <!-- Disable auto white balance and exposure -->

  <rosparam command="delete" param="robot_calibration" />


  <group if="$(arg use_camera)">
  <!-- Very important enable ordered_pc, because robot_calibration soen't work without this option -->
  <!-- roslaunch realsense2_camera rs_camera.launch filters:=pointcloud align_depth:=true ordered_pc:=true-->
    <include file="$(find realsense2_camera)/launch/rs_camera.launch">
      <arg name="filters" value="pointcloud"/>
      <arg name="align_depth" value="true"/>
      <arg name="ordered_pc" value="true"/>
    </include>
  </group>

  <node pkg="robot_calibration" type="calibrate" name="robot_calibration"
        args="$(find z1_calibration)/config/calibration_poses.bag"
        output="screen" required="true">
    <param name="velocity_factor" value="$(arg velocity_factor)" />
    <rosparam file="$(find z1_calibration)/config/capture_checkerboards.yaml" command="load" />
    <rosparam file="$(find z1_calibration)/config/calibrate.yaml" command="load" />
  </node>

  <node pkg="rosbag" type="record" name="calibration_bagger" output="screen"
        args="--bz2 -o /tmp/z1_calibration/calibration_data calibration_data robot_description" >
    <param name="mkdir_tmp" command="mkdir -m 777 -p /tmp/z1_calibration" />
  </node>

  <include file="$(find z1_moveit_config)/launch/move_group.launch" if="$(arg moveit)"/>
  
</launch>

